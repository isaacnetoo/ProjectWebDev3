<!DOCTYPE html>

<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Find & buy the best bet products in Canada online </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="./css/body.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/filter.css">
    <link rel="stylesheet" href="./css/productDisplay.css">
    <link rel="stylesheet" href="./css/footer.css">
    <link rel="stylesheet" href="./css/cart.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto:wght@400;500;700&display=swap"
        rel="stylesheet">


</head>

<body>

    <header>
        <div class="header-container">
            <div class="first-column">
                <div class="first-column-first-row">
                    <p>1-844-799-7387</p>

                    <a href="https://www.facebook.com/canadianpetconnection">
                        <img src="./img/facebook.png" alt="Facebook">
                    </a>

                    <a href="https://twitter.com/i/flow/login?redirect_after_login=%2FCanPetConn">
                        <img src="./img/twitter.png" alt="twitter">
                    </a>
                    <a href="https://www.instagram.com/canadianpetconnection/">
                        <img src="./img/instagram.png" alt="ins">
                    </a>
                    <a href="https://www.youtube.com/channel/UC0ugFWgeUh3LDZyCzwd5dAQ">
                        <img src="./img/youtube.png" alt="youtube">
                    </a>
                </div>

                <div class="first-column-second-row">
                    <h2><a href="./index.html">PawPalsMarket Connection </a></h2>
                </div>

                <div class="first-column-third-row">

                    <a href="https://www.canadianpetconnection.ca/shop-all-brands/">Shop by Brand</a>

                    <a href="https://www.canadianpetconnection.ca/book-the-pet-expert/">Book a Consultation</a>

                </div>
            </div>

            <div class="second-column">
                <img src="./img/PawPalSmarket-logo.png" alt="website-logo" class="website-logo">

            </div>

            <div class="third-column">

                <button class="hamburger-menu" aria-label="Open menu">
                    <img src="./img/icons8-hamburger-menu-50.png" alt="Menu" id="BurgerMenu">
                </button>
                <div class="third-column-first-row">
                    <a href="./index.html">Home</a>
                    <a href="https://www.canadianpetconnection.ca/get-to-know-us/">About Us</a>
                    <a href="https://www.canadianpetconnection.ca/my-account/">Login</a>
                    <a href="https://www.canadianpetconnection.ca/my-cart/">MyPetCart</a>
                    <div class="cart-widget">
                        <img src="./img/icons8-add-shopping-cart-50.png" alt="Cart Icon">
                        <span class="cart-count">0</span> <!-- Assuming there are 3 items in the cart -->
                    </div>
                </div>



                <div class="search-container">
                    <input type="text" placeholder="What are you looking for today?" id="search-bar">
                </div>

                <div class="third-column-third-row">

                    <a href="https://www.canadianpetconnection.ca/pet-news/">New & Resources</a>

                    <a href="https://www.canadianpetconnection.ca/sale/">Sales</a>

                </div>
            </div>
        </div>

        <div class="header-catergory-container">
            <div class="text-container">
                <a href="">Dog</a>
                <a href="">Cat</a>
                <a href="">Ferret</a>
                <a href="">Small Animal</a>
                <a href="">Reptile</a>
                <a href="">Bird</a>
                <a href="">Fish</a>
                <a href="">Farm</a>
                <a href="">People</a>
                <a href="">Gift Cards</a>
                <a href="">Best Sellers</a>
                <a href="">Bundles</a>
            </div>
        </div>
    </header>


    <section class="customize-filter">
        <div class="filter-container">
            <div class="text-result-container">
                <h3>Found <strong id="productCounter"></strong> matching results for your search.</h3>
            </div>
            <div class="select-container">
                <select id="categoryFilter">
                    <option value="all">All&nbsp Products</option>
                    <option value="dogFood">Dog&nbsp Products</option>
                    <option value="catFood">Cat&nbsp Products</option>
                    <option value="rabbitFood">Rabbit&nbsp Products</option>
                    <option value="price">Sorted by Price </option>
                    <option value="rate">Sorted by Rate </option>
                </select>
                <div />
            </div>
    </section>




    <section class="product-display">
        <!-- <div class ="sorted">

        </div> -->
        <div class="product-display-container">

            <div class="product" id="ProductId">
                <img src="./product_gallery/v-planet-mini-bites-kibbles.jpg" alt="dogFood">
                <h4>V-planet Mini Bites Vegan Adult Dog Food by V-Dog</h4>
                <h3>Price:<span>38</span></h3>
                <h3>Rating: &nbsp<span>4.7</span></h3>
                <div class="CartButton-button-container">
                    <button class="CartButton">add to Cart</button>
                </div>
            </div>
        </div>

    </section>

    <div class="cartTab">
        <h1>Shopping Cart <img src="./img/icons8-add-shopping-cart-50.png" alt="Icon" style="width: 25px; height: 25px;"
                id="firstCartIcon"></h1>
        <div class="listCart">
            <!-- product display in cart template  -->
            <!-- <div class="item">
                <div class="image">
                    <img src="./product_gallery/v-planet-mini-bites-kibbles.jpg" alt="items">
                </div>
                <div class="name">
                    Farmina-Ancestral-Grain-Chicken-Pomegranate-Neutered-Adult-Cat-Food-PixTeller
                </div>
                <div class="itemPrice">
                    $38
                </div>
                <div class="amount">
                    <span class="minus">-</span>
                    <span class="itemAmount" >1</span>
                    <span class="plus">+</span>
                </div>

            </div> -->



        </div>
        <div class="totalPrice">
            <h4>You have added <span class="itemNumber">0</span> items to your Cart. <br>Total Price: <span
                    class="total-price"><span>0</span></h3>
        </div>
        <div class="btn">
            <button class="close">CLOSE CART</button>
            <button class="reset">RESET CART</button>
            <button class="check">CHECK OUT</button>
        </div>

    </div>




    <footer>
        <div class="footer-container">
            <div class="footer-text-container">
                <p>Â© 2024 PawPalsMarket Connection Inc. All Rights Reserved</p>
            </div>

            <div class="footer-image-container">
                <a href="https://www.greengeeks.ca/going-green">
                    <img src="./img/pet-community.jpg" alt="petcomunity">
                </a>
            </div>
            <div class="footer-image-container">
                <img src="./img/Pets-Canada-ENG-Logo-2.png.png" alt="pijac">
            </div>
        </div>
    </footer>


    <script type="module">
        import Cart from "./js/cartClass.js";
        import { productList, shoppingCartList } from './js/dataStore.js';
        import { handleCart } from './js/cart.js';

        // hamburger menu
        document.addEventListener("DOMContentLoaded", function () {
            const hamburgerMenu = document.querySelector('.hamburger-menu');
            const burgerImg = document.getElementById('BurgerMenu')
            // Use querySelectorAll to get all links you want to toggle
            const navLinks = document.querySelectorAll('.third-column-first-row a');

            hamburgerMenu.addEventListener('click', function () {
                // Loop through each link and toggle the class
                navLinks.forEach(link => {
                    link.classList.toggle('show-links');
                });

                if (burgerImg.getAttribute('src') === "./img/icons8-hamburger-menu-50.png") {
                    // If currently hamburger icon, change to close icon
                    burgerImg.src = "./img/icons8-close-50.png";
                } else {
                    // If currently close icon, change back to hamburger icon
                    burgerImg.src = "./img/icons8-hamburger-menu-50.png";
                }
                    });

          
        });


        // const productList = new Map();  // already created the map in datastore.js
        // const shoppingCartList = new Map(); // already created the map in datastore.js



        // function to load product from json 
        const load = () => {
            const xHttp = new XMLHttpRequest();

            xHttp.onload = () => {
                // Parse the file data as JSON
                let tmpData = JSON.parse(xHttp.responseText);

                // Iterate over the data
                for (let data of tmpData) {
                    // Set key-value pairs in the productList map
                    productList.set(data.pid, data);

                }
                //literate the product list
                for (let value of productList.values()) {
                    console.log(value);

                    // After loading and populating productList, display the products
                    displayProduct(); // Call the function to display products
                }

            };
            xHttp.open("GET", "./data/mock.data.json"); // Open the request
            xHttp.send(); // Send the request
        }
        load();

        // search bar 
        const searchBar = document.getElementById('search-bar');

        searchBar.addEventListener('input', e => {
            // keep tracking user input 
            const inputValue = e.target.value.toLowerCase();
            // console.log(inputValue);
            displayProduct('all', inputValue)
        })



        // filter and product display based on user option 

        const categoryFilter = document.getElementById('categoryFilter');
        categoryFilter.addEventListener('change', e => {
            const selectedCategory = e.target.value; // Correctly get the selected option
            // console.log(selectedCategory); 
            displayProduct(selectedCategory); // Filter and display products
        });


        // default parameter is all 
        const displayProduct = (category = 'all', searchQuery = '') => {

            const productDisplayContainer = document.querySelector(".product-display-container");
            productDisplayContainer.innerHTML = '';

            const productNumCounter = document.getElementById("productCounter");
            productNumCounter.innerHTML = '';
            //initially convert productList map to an array for sorting and filtering
            let productsArray = Array.from(productList.values());

            //so now in this array, there are several product object, product.name = product name 
            // the way to iterate the products array 
            // for (let i = 0; i < productsArray.length; i++) {
            //     const product = productsArray[i];
            // }


            //logic sort by price from low to high
            if (category === 'price') {
                productsArray.sort((a, b) => a.price - b.price);

            }

            // logic sort by rating form high to low 
            if (category === 'rate') {
                productsArray.sort((a, b) => b.rating - a.rating);
            }

            //counter to display product result 
            let count = 0;

            for (let product of productsArray) {
                // Matching the user input in the search bar to product name in lowercase 
                const matchSearchQuery = product.name.toLowerCase().includes(searchQuery);

                console.log(matchSearchQuery);
                //categroy =  dogFood or catFood or rabbitFood or price or rate / all = display all product
                if ((category === 'all' || product.category === category || category === 'price' || category === 'rate') && matchSearchQuery) {
                    count++;
                    const productElement = document.createElement("div");
                    productElement.classList.add("product"); // add class name product
                    productElement.id = product.pid; //set up id =pid 
                    //handle click event of add to cart 


                    productElement.innerHTML =
                        `<img src="${product.imagePath}" alt="${product.category}">
                        <h4>${product.name}</h4>
                        <h3>Price :&nbsp<span>${product.price}</span></h3>
                        <h3>Rating: <span>${product.rating}</span></h3>
                        <div class ="CartButton-button-container">
                            <button class="CartButton">Add to Cart</button>
                        </div>`;

                    // add products to html 

                    productDisplayContainer.append(productElement);
                }

            }
            // add product result to html 
            productNumCounter.append(count);

            // add click event to add to cart button 
            for (let addtoCart of document.querySelectorAll(".CartButton")) {

                addtoCart.addEventListener("click", handleCart);

            }
        }

    </script>
    <!-- external cart  js  -->
    <script type="module" src="./js/cart.js"></script>

</body>

</html>